# ComfyUI-Prompt-Presets

一个为 ComfyUI 设计的提示词预设管理插件，提供悬浮菜单快速添加专业级预设，并支持智能优先级排序。

![ComfyUI](https://img.shields.io/badge/ComfyUI-Plugin-blue)
![License](https://img.shields.io/badge/License-MIT-green)

## ✨ 功能特性

### 🎯 核心功能

- **悬浮预设菜单** - 右下角悬浮按钮，鼠标悬停展开分类菜单
- **一键添加预设** - 点击预设即可追加到选中节点的提示词输入框
- **预设预览** - 悬停显示预设效果图片/视频
- **智能排序** - 自动按优先级（Tier 1-7）重排提示词顺序
- **自定义预设** - 支持添加和管理用户自定义预设
- **黑白名单** - 配置识别/排除特定 widget 名称

### 📂 三级预设分类

插件采用 **一级分类 → 二级分组 → 三级预设** 的三层结构：

| 一级分类 | 二级分组 | 优先级 |
|---------|---------|--------|
| 🎥 镜头与构图 | 运镜动作 (视频) | Tier 1 |
|  | 景别与构图 | Tier 2 |
|  | 镜头视角与焦距 | Tier 3 |
| 💡 光影与环境 | 建筑与空间 | Tier 4 |
|  | 光影与氛围 | Tier 5 |
| 🎨 风格与主题 | 风格与美术基调 | Tier 6 |
|  | 动漫与插画 | Tier 6 |
|  | 绘画与传统艺术 | Tier 6 |
|  | 设计风格运动 | Tier 6 |
|  | 材质与工艺 | Tier 6 |
|  | 人像与时尚 | Tier 6 |
|  | 产品与电商 | Tier 6 |
| 🎞️ 质感与后期 | 器材与介质质感 | Tier 7 |
|  | 特效与后处理 | Tier 7 |
|  | 通用画质增强 | Tier 7 |

> **Tier 4 用户输入**：您的主体描述会自动插入到 Tier 3 和 Tier 5 之间

## 🚀 安装

### 方法一：手动安装

```bash
cd ComfyUI/custom_nodes/
git clone https://github.com/iOrange-ZR/ComfyUI-Prompt-Presets.git
```

### 方法二：复制文件夹

将整个 `ComfyUI-Prompt-Presets` 文件夹复制到 `ComfyUI/custom_nodes/` 目录下。

安装后重启 ComfyUI 即可使用。

## 📖 使用方法

### 基本操作

1. **选中节点** - 点击画布中有提示词输入框的节点
2. **打开菜单** - 鼠标悬停在右下角 📝 按钮上
3. **选择预设** - 依次进入 **一级分类 → 二级分组 → 三级预设**
4. **查看结果** - 预设会自动追加到选中节点，并按优先级排序

### 预览功能

- 悬停在三级预设项上可查看效果预览图/视频
- 预览图会自动显示在菜单旁边

### 管理已添加

- 点击菜单中的「管理已添加」可查看当前 prompt 中的预设
- 支持删除单个预设或编辑内容

### 自定义预设

- 点击菜单中的「✨ 自定义」进入自定义预设管理
- 支持添加、编辑、删除自定义预设

### 设置

- 点击菜单中的「⚙️ 设置」打开配置面板
- **白名单**：添加需要识别的 widget 名称
- **黑名单**：排除不需要识别的 widget 名称

## 🔧 智能排序说明

当您添加多个不同分类的预设时，插件会自动按优先级重新排列：

```
添加顺序：赛博朋克 → 环绕运镜 → 特写镜头
自动排序：【环绕运镜】, 【特写镜头】, 用户输入, 【赛博朋克】
           ↑ Tier 1      ↑ Tier 2           ↑ Tier 6
```

这确保 AI 在生成时优先处理运镜动作和构图，避免因 prompt 过长导致遗漏关键特征。

## 📁 文件结构

```
ComfyUI-Prompt-Presets/
├── __init__.py          # 后端入口，API 路由
├── prompt_presets.json  # 预设数据（含 tier 优先级）
├── README.md            # 本文档
├── previews/            # 预设预览图片/视频
│   ├── Cyberpunk.jpg
│   └── ...
└── web/
    └── prompt_presets.js  # 前端 UI 和逻辑
```

## 🎨 添加预览图片

1. 将图片放入 `previews/` 文件夹
2. 在 `prompt_presets.json` 中为对应预设添加 `"image": "文件名.png"`

支持格式：`jpg`, `png`, `webp`, `gif`, `mp4`, `webm`

## ⚙️ 自定义预设数据

编辑 `prompt_presets.json` 可添加/修改预设（三级结构）：

```json
[
    {
        "category": "🎨 一级分类名称",
        "category_en": "Category Name",
        "groups": [
            {
                "name": "二级分组名称",
                "name_en": "Group Name",
                "tier": 6,
                "presets": [
                    {
                        "sub_category": "三级预设名称 (English)",
                        "prompt_value": "prompt text here",
                        "image": "preview_image.png"
                    }
                ]
            }
        ]
    }
]
```

## 📝 更新日志

### v1.1.0 (2026-01-28)

#### 🖼️ 预览图功能增强
- **修复预览图加载问题** - 解决后端路由 `{filename}` 无法匹配完整文件名的问题，改用 `{filename:.+}` 正则匹配
- **添加 URL 解码** - 支持带空格等特殊字符的文件名正确加载
- **优化预览弹窗定位** - 预览图现在正确显示在三级菜单旁边，根据菜单展开方向自动调整位置

#### 🎯 UI 改进
- **悬浮按钮响应式** - 添加窗口大小监听，页面缩放时悬浮按钮始终保持在可视区域内
- **移除预设项图标** - 去掉菜单项旁边多余的 🖼️ 图标，保持界面简洁

#### 📸 新增预览图（80+张）
- **镜头与构图**：景别与构图（12张）、镜头视角与焦距（8张）
- **光影与环境**：光影与氛围（14张）、建筑与空间（5张）
- **风格与主题**：风格与美术基调（已有）、人像与时尚（2张新增）
- **质感与后期**：器材与介质质感（9张）、特效与后处理（10张）

#### ✏️ 提示词优化
- **莫兰迪色** - 优化为柔和灰调、宁静诗意的描述，移除不相关的战争场景
- **复古暖色** - 专注于暖色调描述，移除老照片、电影风格等混杂元素

### v1.0.0
- 初始版本发布
- 悬浮菜单 + 级联分类
- 自定义预设管理
- 预设预览功能
- 智能优先级排序（Tier 1-7）
- 白名单/黑名单配置
- 多输入框选择支持

## 📄 License

MIT License
